<% content_for :main_class, "flex flex-1 justify-center px-4 py-5 sm:px-6 lg:px-8" %>

<div class="w-full max-w-3xl space-y-8 pb-32">
  <%= render "shared/flash" %>

  <section class="rounded-3xl border border-white/40 bg-white/80 p-6 shadow-xl backdrop-blur">
    <div class="flex items-start justify-between gap-4">
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-3">
          <% if @milestone.completed? %>
            <span class="flex-shrink-0 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </span>
          <% end %>
          <h1 class="text-2xl font-bold text-slate-900 <%= 'line-through text-slate-400' if @milestone.completed? %>">
            <%= @milestone.name %>
          </h1>
        </div>
        <% if @milestone.description.present? %>
          <p class="mt-2 text-slate-600"><%= @milestone.description %></p>
        <% end %>
        <p class="mt-3 text-sm text-slate-500">
          Part of <%= link_to @project.name, project_path(@project), class: "text-blue-600 hover:text-blue-800 transition" %>
        </p>
      </div>
      <div class="flex items-center gap-2">
        <%= button_to toggle_complete_project_milestone_path(@project, @milestone),
              method: :patch,
              class: "rounded-full border px-4 py-2 text-sm font-medium transition #{@milestone.completed? ? 'border-blue-500 text-blue-600 hover:bg-blue-50' : 'border-green-500 text-green-600 hover:bg-green-50'}",
              title: @milestone.completed? ? "Mark as active" : "Mark as complete" do %>
          <%= @milestone.completed? ? "Reopen" : "Complete" %>
        <% end %>
      </div>
    </div>
  </section>

  <section class="rounded-3xl border border-white/30 bg-white/70 p-6 shadow-lg backdrop-blur">
    <h2 class="text-lg font-semibold text-slate-900 mb-4">Todos</h2>

    <%= render "milestones/todo_form", project: @project, milestone: @milestone, todo: @todo %>

    <%= render "milestones/todos_list", milestone: @milestone, active_todos: @active_todos, completed_todos: @completed_todos %>
  </section>

  <div class="text-center">
    <%= link_to "Back to #{@project.name}", project_path(@project),
          class: "text-sm text-slate-500 hover:text-slate-700 transition" %>
  </div>
</div>

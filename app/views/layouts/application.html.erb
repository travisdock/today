<!DOCTYPE html>
<html>
  <head>
    <title><%= page_title %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="theme-color" content="<%= page_theme_color %>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Today">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/today-icon-512.png" type="image/png">
    <link rel="icon" href="/today-icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/today-icon-512.png">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="m-0 flex min-h-screen flex-col <%= page_gradient_class %> bg-fixed font-sans text-slate-900">
    <nav class="flex items-center justify-between px-4 py-4 text-slate-50 sm:px-6 lg:px-8" style="padding-top: max(1rem, env(safe-area-inset-top)); padding-left: max(1rem, env(safe-area-inset-left)); padding-right: max(1rem, env(safe-area-inset-right))">
      <div class="flex items-center">
        <span class="text-2xl font-semibold tracking-tight"><%= page_title %></span>
      </div>
      <div class="flex items-center gap-4">
        <% if authenticated? %>
          <%# Desktop nav links - hidden on mobile %>
          <div class="hidden sm:flex sm:items-center sm:gap-4">
            <%= link_to "Todos", todos_path, class: nav_item_classes(active: controller_name == "todos") %>
            <%= link_to "Projects", projects_path, class: nav_item_classes(active: controller_name == "projects") %>
            <%= link_to "Calendar", events_path, class: nav_item_classes(active: controller_name == "events") %>
          </div>
          <div class="relative" data-controller="dropdown">
            <button data-action="click->dropdown#toggle" class="inline-flex items-center gap-1 rounded-full border border-white/70 bg-slate-900/25 px-4 py-2 text-sm font-semibold text-slate-50 shadow-sm transition hover:bg-slate-900/40">
              <span class="sm:hidden">Menu</span>
              <span class="hidden sm:inline">Account</span>
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div data-dropdown-target="menu" class="hidden absolute right-0 mt-2 w-48 rounded-xl bg-white shadow-lg ring-1 ring-black/5 z-50">
              <div class="py-1">
                <%# Mobile nav links - hidden on desktop %>
                <div class="sm:hidden border-b border-slate-200 pb-1 mb-1">
                  <%= link_to "Todos", todos_path, class: "block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 #{controller_name == 'todos' ? 'font-semibold' : ''}" %>
                  <%= link_to "Projects", projects_path, class: "block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 #{controller_name == 'projects' ? 'font-semibold' : ''}" %>
                  <%= link_to "Calendar", events_path, class: "block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 #{controller_name == 'events' ? 'font-semibold' : ''}" %>
                </div>
                <%= link_to "API Tokens", api_tokens_path, class: "block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 #{controller_name == 'api_tokens' ? 'font-semibold' : ''}" %>
                <%= button_to "Sign out", session_path,
                    method: :delete,
                    class: "block w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100",
                    form: { class: "block" } %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </nav>
    <main class="<%= content_for?(:main_class) ? yield(:main_class) : "flex flex-1 items-center justify-center px-4 py-12 sm:px-6 lg:px-8" %>" style="padding-left: max(1rem, env(safe-area-inset-left)); padding-right: max(1rem, env(safe-area-inset-right)); padding-bottom: max(3rem, env(safe-area-inset-bottom))">
      <%= yield %>
    </main>
  </body>
</html>

<div id="todo_form" data-controller="form-morph">
  <div data-form-morph-target="container" class="overflow-hidden transition-all duration-300 ease-in-out">
    <button type="button"
            data-action="click->form-morph#expand"
            data-form-morph-target="button"
            class="flex w-full items-center justify-center gap-2 rounded-2xl bg-slate-100 px-4 py-2 text-sm font-semibold uppercase tracking-wide text-slate-600 transition-all duration-200 hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
      <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
      </svg>
      <span>Add a todo manually</span>
    </button>

    <%= form_with model: todo, url: todos_path, class: "space-y-4", data: { form_morph_target: "form" } do |form| %>
      <div data-form-morph-target="formContent" class="mt-4 hidden opacity-0 transition-opacity duration-300">
        <div class="flex flex-col gap-3 sm:flex-row">
          <%= form.text_field :title,
                required: true,
                placeholder: "What do you need to do?",
                data: { form_morph_target: "input" },
                class: "w-full flex-1 rounded-2xl border border-slate-300/80 bg-white px-4 py-3 text-base text-slate-900 placeholder:text-slate-400 focus:border-blue-500 focus:outline-none focus:ring-4 focus:ring-blue-400/30" %>
          <%= form.select :priority_window,
                Todo.priority_windows.keys.map { |w| [w.titleize, w] },
                {},
                {
                  required: true,
                  style: "background-image: url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e\"); background-position: right 0.75rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em;",
                  class: "appearance-none rounded-2xl border border-slate-300/80 bg-white pl-4 pr-10 py-3 text-base text-slate-900 focus:border-blue-500 focus:outline-none focus:ring-4 focus:ring-blue-400/30"
                } %>
          <%= form.submit "Add",
                class: "rounded-2xl bg-blue-600 px-5 py-3 text-sm font-semibold uppercase tracking-wide text-white shadow-md transition hover:-translate-y-0.5 hover:bg-blue-500 focus:outline-none focus:ring-4 focus:ring-blue-400/40" %>
        </div>

        <% if todo.errors.any? %>
          <ul class="mt-3 space-y-1 text-sm text-red-600">
            <% todo.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        <% end %>

        <button type="button"
                data-action="click->form-morph#collapse"
                class="mt-3 text-sm text-slate-500 hover:text-slate-700 transition">
          Cancel
        </button>
      </div>
    <% end %>
  </div>
</div>
